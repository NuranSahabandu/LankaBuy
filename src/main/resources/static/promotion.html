<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Promotion Management</title>
    <style>
        body { font-family: Arial; background-color: #fff5f5; }
        h1 { color: #b30000; }
        table, th, td { border: 1px solid black; border-collapse: collapse; padding: 8px; }
        input, textarea { width: 90%; padding: 6px; margin: 4px; }
        button { background-color: #ff6666; color: white; border: none; padding: 6px 12px; cursor: pointer; }
        button:hover { background-color: #ff4d4d; }
    </style>
</head>
<body>
<h1>Promotion Management</h1>

<form id="promotionForm">
    <input type="hidden" id="promotionId" />
    <label>Title:</label><br>
    <input type="text" id="title" required><br>
    <label>Description:</label><br>
    <textarea id="description" required></textarea><br>
    <label>Discount %:</label><br>
    <input type="number" id="discountPercent" required><br>
    <label>Start Date:</label><br>
    <input type="date" id="startDate" required><br>
    <label>End Date:</label><br>
    <input type="date" id="endDate" required><br><br>
    <button type="submit">Save Promotion</button>
</form>

<hr>

<h2>Existing Promotions</h2>
<table id="promotionTable">
    <thead>
    <tr>
        <th>ID</th><th>Title</th><th>Description</th><th>Discount %</th><th>Start</th><th>End</th><th>Actions</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const API = "http://localhost:8080/api/promotions";

    async function loadPromotions() {
        const res = await fetch(API);
        const data = await res.json();
        const tbody = document.querySelector("#promotionTable tbody");
        tbody.innerHTML = "";
        data.forEach(p => {
            tbody.innerHTML += `
          <tr>
            <td>${p.id}</td>
            <td>${p.title}</td>
            <td>${p.description}</td>
            <td>${p.discountPercent}</td>
            <td>${p.startDate}</td>
            <td>${p.endDate}</td>
            <td>
              <button onclick="editPromotion(${p.id})">Edit</button>
              <button onclick="deletePromotion(${p.id})">Delete</button>
            </td>
          </tr>`;
        });
    }

    document.querySelector("#promotionForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const id = document.getElementById("promotionId").value;
        const promotion = {
            title: document.getElementById("title").value,
            description: document.getElementById("description").value,
            discountPercent: document.getElementById("discountPercent").value,
            startDate: document.getElementById("startDate").value,
            endDate: document.getElementById("endDate").value
        };
        if (id) {
            await fetch(`${API}/${id}`, { method: "PUT", headers: { "Content-Type": "application/json" }, body: JSON.stringify(promotion) });
        } else {
            await fetch(API, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(promotion) });
        }
        e.target.reset();
        document.getElementById("promotionId").value = "";
        loadPromotions();
    });

    async function editPromotion(id) {
        const res = await fetch(`${API}/${id}`);
        const p = await res.json();
        document.getElementById("promotionId").value = p.id;
        document.getElementById("title").value = p.title;
        document.getElementById("description").value = p.description;
        document.getElementById("discountPercent").value = p.discountPercent;
        document.getElementById("startDate").value = p.startDate;
        document.getElementById("endDate").value = p.endDate;
    }

    async function deletePromotion(id) {
        if (confirm("Are you sure you want to delete this promotion?")) {
            await fetch(`${API}/${id}`, { method: "DELETE" });
            loadPromotions();
        }
    }

    loadPromotions();
</script>
</body>
</html>
